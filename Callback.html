<html><head><title></title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="http://search.cpan.org/s/style.css">

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.26,
  using Pod::Simple::PullParser v3.26,
  under Perl v5.016003 at Sun Sep  1 17:39:05 2013 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#safe_open3(_%24command%2C_%24arg1%2C_...%2C_%24argN_)'>safe_open3( $command, $arg1, ..., $argN )</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#CONSTRUCTOR'>CONSTRUCTOR</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#new(_%5C%25options_)'>new( \%options )</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#run_command(_%24command%2C_%24arg1%2C_...%2C_%24argN%2C_%5C%25options_)'>run_command( $command, $arg1, ..., $argN, \%options )</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT'>COPYRIGHT</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>IPC::Open3::Callback - An extension to IPC::Open3 that will feed out and err to callbacks instead of requiring the caller to handle them.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  use IPC::Open3::Callback;
  my $runner = IPC::Open3::Callback-&#62;new( 
      out_callback =&#62; sub {
          my $data = shift;
          my $pid = shift;

          print( &#34;$pid STDOUT: $data\n&#34; );
      },
      err_callback =&#62; sub {
          my $data = shift;
          my $pid = shift;

          print( &#34;$pid STDERR: $data\n&#34; );
      } );
  my $exit_code = $runner-&#62;run_command( &#39;echo Hello World&#39; );

  use IPC::Open3::Callback qw(safe_open3);
  my ($pid, $in, $out, $err) = safe_open3( &#34;echo&#34;, &#34;Hello&#34;, &#34;world&#34; ); 
  $buffer = &#39;&#39;;
  my $select = IO::Select-&#62;new();
  $select-&#62;add( $out );
  while ( my @ready = $select-&#62;can_read( 5 ) ) {
      foreach my $fh ( @ready ) {
          my $line;
          my $bytes_read = sysread( $fh, $line, 1024 );
          if ( ! defined( $bytes_read ) &#38;&#38; !$!{ECONNRESET} ) {
              die( &#34;error in running (&#39;echo $echo&#39;): $!&#34; );
          }
          elsif ( ! defined( $bytes_read) || $bytes_read == 0 ) {
              $select-&#62;remove( $fh );
              next;
          }
          else {
              if ( $fh == $out ) {
                  $buffer .= $line;
              }
              else {
                  die( &#34;impossible... somehow got a filehandle i dont know about!&#34; );
              }
          }
      }
  } 
  waitpid( $pid, 0 );
  my $exit_code = $? &#62;&#62; 8;
  print( &#34;$pid exited with $exit_code: $buffer\n&#34; ); # 123 exited with 0: Hello World</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module feeds output and error stream from a command to supplied callbacks. Thus, this class removes the necessity of dealing with <a href="http://search.cpan.org/perldoc?IO%3A%3ASelect" class="podlinkpod"
>IO::Select</a> by hand and also provides a workaround for Windows systems.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="safe_open3(_$command,_$arg1,_...,_$argN_)"
>safe_open3( $command, $arg1, ..., $argN )</a></h2>

<p>Passes the command and arguments on to <code>open3</code> and returns a list containing:</p>

<dl>
<dt><a name="pid"
>pid</a></dt>

<dd>
<p>The process id of the forked process</p>

<dt><a name="stdin"
>stdin</a></dt>

<dd>
<p>An <a href="http://search.cpan.org/perldoc?IO%3A%3AHandle" class="podlinkpod"
>IO::Handle</a> to STDIN for the process</p>

<dt><a name="stdout"
>stdout</a></dt>

<dd>
<p>An <a href="http://search.cpan.org/perldoc?IO%3A%3AHandle" class="podlinkpod"
>IO::Handle</a> to STDOUT for the process</p>

<dt><a name="stderr"
>stderr</a></dt>

<dd>
<p>An <a href="http://search.cpan.org/perldoc?IO%3A%3AHandle" class="podlinkpod"
>IO::Handle</a> to STDERR for the process</p>
</dd>
</dl>

<p>As with <code>open3</code>, it is the callers responsibility to waitpid to ensure forked processes do not become zombies.</p>

<p>This method works for both *nix and Windows sytems. On a windows system, it will use sockets per <a href="http://www.perlmonks.org/index.pl?node_id=811150" class="podlinkurl"
>http://www.perlmonks.org/index.pl?node_id=811150</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONSTRUCTOR"
>CONSTRUCTOR</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="new(_\%options_)"
>new( \%options )</a></h2>

<p>The constructor creates a new Callback object and optionally sets global callbacks for <code>STDOUT</code> and <code>STDERR</code> streams from commands that will get run by this object (can be overridden per call to <a href="#run_command(_%24command%2C_%24arg1%2C_...%2C_%24argN%2C_%5C%25options_)" class="podlinkpod"
>run_command</a>).</p>

<dl>
<dt><a name="out_callback"
>out_callback</a></dt>

<dd>
<p>A subroutine to call for each chunk of text written to <code>STDOUT</code>. This subroutine will be called with 2 arguments:</p>

<dl>
<dt><a name="data"
>data</a></dt>

<dd>
<p>A chunk of text written to the stream</p>

<dt><a name="pid"
>pid</a></dt>

<dd>
<p>The pid of the forked process</p>
</dd>
</dl>

<dt><a name="err_callback"
>err_callback</a></dt>

<dd>
<p>A subroutine to call for each chunk of text written to <code>STDERR</code>. This subroutine will be called with the same 2 arguments as <code>out_callback</code></p>

<dt><a name="buffer_output"
>buffer_output</a></dt>

<dd>
<p>A boolean value, if true, will buffer output and send to callback one line at a time (waits for &#39;\n&#39;). Otherwise, sends text in the same chunks returned by <a href="http://search.cpan.org/perldoc?sysread" class="podlinkpod"
>sysread</a>.</p>

<dt><a name="select_timeout"
>select_timeout</a></dt>

<dd>
<p>The timeout, in seconds, provided to <code>IO::Select</code>, by default 0 meaning no timeout which will cause the loop to block until output is ready on either <code>STDOUT</code> or <code>STDERR</code>.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="run_command(_$command,_$arg1,_...,_$argN,_\%options_)"
>run_command( $command, $arg1, ..., $argN, \%options )</a></h2>

<p>Will run the specified command with the supplied arguments by passing them on to <a href="#safe_open3(_%24command%2C_%24arg1%2C_...%2C_%24argN_)" class="podlinkpod"
>safe_open3</a>. Arguments can be embedded in the command string and are thus optional.</p>

<p>If the last argument to this method is a hashref (<code>ref(@_[-1]) eq &#39;HASH&#39;</code>), then it is treated as an options hash. The supported allowed options are the same as the constructor and will be used in preference to the values set in the constructor for this call.</p>

<p>Returns the exit code from the command.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Lucas Theisen (lucastheisen@pastdev.com)</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>Copyright 2013 pastdev.com. All rights reserved.</p>

<p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="http://search.cpan.org/perldoc?IPC%3A%3AOpen3" class="podlinkpod"
>IPC::Open3</a> <a href="http://search.cpan.org/perldoc?IPC%3A%3AOpen3%3A%3ACallback%3A%3ACommand" class="podlinkpod"
>IPC::Open3::Callback::Command</a> <a href="http://search.cpan.org/perldoc?IPC%3A%3AOpen3%3A%3ACallback%3A%3ACommandRunner" class="podlinkpod"
>IPC::Open3::Callback::CommandRunner</a> <a href="https://github.com/lucastheisen/ipc-open3-callback" class="podlinkurl"
>https://github.com/lucastheisen/ipc-open3-callback</a> <a href="http://stackoverflow.com/q/16675950/516433" class="podlinkurl"
>http://stackoverflow.com/q/16675950/516433</a></p>

<!-- end doc -->

</body></html>
