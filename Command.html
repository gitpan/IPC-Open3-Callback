<html><head><title>IPC::Open3::Callback::Command</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="http://search.cpan.org/s/style.css">

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.26,
  using Pod::Simple::PullParser v3.26,
  under Perl v5.016003 at Sun Sep  1 18:24:01 2013 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#command(_%24command%2C_%5C%25destination_options_)'>command( $command, \%destination_options )</a>
    <li class='indexItem indexItem2'><a href='#batch_command(_%24command1%2C_%24command2%2C_...%2C_%24commandN%2C_%5C%25destination_options_)'>batch_command( $command1, $command2, ..., $commandN, \%destination_options )</a>
    <li class='indexItem indexItem2'><a href='#mkdir_command(_%24path1%2C_%24path2%2C_...%2C_%24pathN%2C_%5C%25destination_options_)'>mkdir_command( $path1, $path2, ..., $pathN, \%destination_options )</a>
    <li class='indexItem indexItem2'><a href='#pipe_command(_%24command1%2C_%24command2%2C_...%2C_%24commandN%2C_%5C%25destination_options_)'>pipe_command( $command1, $command2, ..., $commandN, \%destination_options )</a>
    <li class='indexItem indexItem2'><a href='#rm_command(_%24path1%2C_%24path2%2C_...%2C_%24pathN%2C_%5C%25destination_options_)'>rm_command( $path1, $path2, ..., $pathN, \%destination_options )</a>
    <li class='indexItem indexItem2'><a href='#sed_command(_%24expression1%2C_%24expression2%2C_...%2C_%24expressionN%2C_%5C%25destination_options_)'>sed_command( $expression1, $expression2, ..., $expressionN, \%destination_options )</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT'>COPYRIGHT</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>IPC::Open3::Callback::Command - A utility class that provides subroutines for building shell command strings.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  use IPC::Open3::Callback::Command qw(command batch_command mkdir_command pipe_command rm_command sed_command);
  my $command = command( &#39;echo&#39; ); # echo

  # ssh foo &#34;echo&#34;
  $command = command( &#39;echo&#39;, {hostname=&#62;&#39;foo&#39;} ); 

  # ssh bar@foo &#34;echo&#34;
  $command = command( &#39;echo&#39;, {username=&#62;&#39;bar&#39;,hostname=&#62;&#39;foo&#39;} ); 
  
  # plink -l bar foo &#34;echo&#34;
  $command = command( &#39;echo&#39;, {username=&#62;&#39;bar&#39;,hostname=&#62;&#39;foo&#39;,ssh=&#62;&#39;plink&#39;} ); 
  
  # cd foo;cd bar
  $command = batch_command( &#39;cd foo&#39;, &#39;cd bar&#39; ); 
  
  # ssh baz &#34;cd foo;cd bar&#34;
  $command = batch_command( &#39;cd foo&#39;, &#39;cd bar&#39;, {hostname=&#62;&#39;baz&#39;} ); 
  
  # ssh baz &#34;sudo cd foo;sudo cd bar&#34;
  $command = batch_command( &#39;cd foo&#39;, &#39;cd bar&#39;, {hostname=&#62;&#39;baz&#39;,command_prefix=&#62;&#39;sudo &#39;} ); 
  
  # ssh baz &#34;mkdir -p \&#34;foo\&#34; \&#34;bar\&#34;&#34;
  $command = mkdir_command( &#39;foo&#39;, &#39;bar&#39;, {hostname=&#62;&#39;baz&#39;} ); 

  # cat abc|ssh baz &#34;dd of=def&#34;
  $command = pipe_command( 
          &#39;cat abc&#39;, 
          command( &#39;dd of=def&#39;, {hostname=&#62;&#39;baz&#39;} ) 
      ); 

  # ssh fred@baz &#34;sudo -u joe rm -rf \&#34;foo\&#34; \&#34;bar\&#34;&#34;
  $command = rm_command( &#39;foo&#39;, &#39;bar&#39;, {username=&#62;&#39;fred&#39;,hostname=&#62;&#39;baz&#39;,command_prefix=&#62;&#39;sudo -u joe &#39;} ); 
  
  # sed -e &#39;s/foo/bar/&#39;
  $command = sed_command( &#39;s/foo/bar/&#39; ); 
  
  
  # curl http://www.google.com|sed -e &#39;s/google/gaggle/g&#39;|ssh fred@baz &#34;sudo -u joe dd of=\&#34;/tmp/gaggle.com\&#34;&#34;;ssh fred@baz &#34;sudo -u joe rm -rf \&#34;/tmp/google.com\&#34;&#34;;
  $command = batch_command(
          pipe_command( 
              &#39;curl http://www.google.com&#39;,
              sed_command( {replace_map=&#62;{google=&#62;&#39;gaggle&#39;}} ),
              command( &#39;dd of=&#34;/tmp/gaggle.com&#34;&#39;, {username=&#62;&#39;fred&#39;,hostname=&#62;&#39;baz&#39;,command_prefix=&#62;&#39;sudo -u joe &#39;} )
          ),
          rm_command( &#39;/tmp/google.com&#39;, {username=&#62;&#39;fred&#39;,hostname=&#62;&#39;baz&#39;,command_prefix=&#62;&#39;sudo -u joe &#39;}) 
      );</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The subroutines exported by this module can build shell command strings that can be executed by IPC::Open3::Callback, IPC::Open3::Callback::CommandRunner, ``, system(), or even plain old open 1, 2, or 3. There is not much point to <i>shelling</i> out for commands locally as there is almost certainly a perl function/library capable of doing whatever you need in perl code. However, If you are designing a footprintless agent that will run commands on remote machines using existing tools (gnu/powershell/bash...) these utilities can be very helpful. All functions in this module can take a <code>\%destination_options</code> hash defining who/where/how to run the command.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<p>All commands can be supplied with <code>\%destination_options</code>. <code>destination_options</code> control who/where/how to run the command. The supported options are:</p>

<dl>
<dt><a name="ssh"
>ssh</a></dt>

<dd>
<p>The ssh command to use, defaults to <code>ssh</code>. You can use this to specify other commands like <code>plink</code> for windows or an implementation of <code>ssh</code> that is not in your path.</p>

<dt><a name="command_prefix"
>command_prefix</a></dt>

<dd>
<p>As it sounds, this is a prefix to your command. Mainly useful for using <code>sudo</code>. This prefix is added like this <code>$command_prefix$command</code> so be sure to put a space at the end of your prefix unless you want to modify the name of the command itself. For example, <code>$command_prefix = &#39;sudo -u priveleged_user &#39;;</code>.</p>

<dt><a name="username"
>username</a></dt>

<dd>
<p>The username to <code>ssh</code> with. If using <code>ssh</code>, this will result in, <code>ssh $username@$hostname</code> but if using <code>plink</code> it will result in <code>plink -l $username $hostname</code>.</p>

<dt><a name="hostname"
>hostname</a></dt>

<dd>
<p>The hostname/IP of the server to run this command on. If localhost, and no username is specified, the command will not be wrapped in <code>ssh</code></p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="command(_$command,_\%destination_options_)"
>command( $command, \%destination_options )</a></h2>

<p>This wraps the supplied command with all the destination options. If no options are supplied, $command is returned.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="batch_command(_$command1,_$command2,_...,_$commandN,_\%destination_options_)"
>batch_command( $command1, $command2, ..., $commandN, \%destination_options )</a></h2>

<p>This will join all the commands with a <code>;</code> and apply the supplied <code>\%destination_options</code> to the result.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="mkdir_command(_$path1,_$path2,_...,_$pathN,_\%destination_options_)"
>mkdir_command( $path1, $path2, ..., $pathN, \%destination_options )</a></h2>

<p>Results in <code>mkdir -p $path1 $path2 ... $pathN</code> with the <code>\%destination_options</code> applied.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="pipe_command(_$command1,_$command2,_...,_$commandN,_\%destination_options_)"
>pipe_command( $command1, $command2, ..., $commandN, \%destination_options )</a></h2>

<p>Identical to <a href="#batch_command(_%24command1%2C_%24command2%2C_...%2C_%24commandN%2C_%5C%25destination_options_)" class="podlinkpod"
>batch_command</a> except uses <code>\|</code> to separate the commands instead of <code>;</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="rm_command(_$path1,_$path2,_...,_$pathN,_\%destination_options_)"
>rm_command( $path1, $path2, ..., $pathN, \%destination_options )</a></h2>

<p>Results in <code>rm -rf $path1 $path2 ... $pathN</code> with the <code>\%destination_options</code> applied. This is a <i>VERY</i> dangerous command and should be used with care.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="sed_command(_$expression1,_$expression2,_...,_$expressionN,_\%destination_options_)"
>sed_command( $expression1, $expression2, ..., $expressionN, \%destination_options )</a></h2>

<p>Constructs a sed command</p>

<dl>
<dt><a name="replace_map"
>replace_map</a></dt>

<dd>
<p>A map used to construct a sed expression where the key is the match portion and the value is the replace portion. For example: <code>{&#39;key&#39;=&#62;&#39;value&#39;}</code> would result in <code>&#39;s/key/value/g&#39;</code>.</p>

<dt><a name="in_place"
>in_place</a></dt>

<dd>
<p>If specified, the <code>-i</code> option will be supplied to <code>sed</code> thus modifying the file argument in place. Not useful for piping commands together, but can be useful if you copy a file to a temp directory, modify it in place, then transfer the file and delete the temp directory. It would be more secure to follow this approach when using sed to fill in passwords in config files. For example, if you wanted to use sed substitions to set passwords in a config file template and then transfer that config file to a remote server:</p>

<p><code>/my/config/passwords.cfg</code></p>

<pre>  app1.username=foo
  app1.password=##APP1_PASSWORD##
  app2.username=bar
  app2.password=##APP2_PASSWORD##</pre>

<p><code>deploy_passwords.pl</code></p>

<pre>  use IPC::Open3::Callback::Command qw(batch_command command pipe_command sed_command);
  use IPC::Open3::Callback::CommandRunner;
  use File::Temp;
  
  my $temp_dir = File::Temp-&#62;newdir();
  my $temp_script_file = File::Temp-&#62;new();
  IPC::Open3::Callback::CommandRunner-&#62;new()-&#62;run_or_die(
      batch_command( 
          &#34;cp /my/config/passwords.cfg $temp_dir-&#62;filename()/passwords.cfg&#34;,
          sed_command( 
              &#34;s/##APP1_PASSWORD##/set4app1/g&#34;,
              &#34;s/##APP2_PASSWORD##/set4app2/g&#34;, 
              {
                  in_place=&#62;1,
                  temp_script_file=&#62;$temp_script_file,
                  files=&#62;[$temp_dir-&#62;filename()/passwords.cfg] 
              } 
          ),
          pipe_command( 
              &#34;cat $temp_dir-&#62;filename()/passwords.cfg&#34;,
              command( &#34;dd of=&#39;/remote/config/passwords.cfg&#39;&#34;, {hostname=&#62;&#39;remote_host&#39;} ) );
      )
  );</pre>

<dt><a name="temp_script_file"
>temp_script_file</a></dt>

<dd>
<p>Specifies a file to write the sed script to rather than using the console. This is useful for avoiding generating commands that would get executed in the console that have protected information like passwords. If passwords are issued on the console, they might show up in the command history...</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Lucas Theisen (lucastheisen@pastdev.com)</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>Copyright 2013 pastdev.com. All rights reserved.</p>

<p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<!-- end doc -->

</body></html>
